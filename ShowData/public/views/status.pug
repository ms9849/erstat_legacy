doctype html
html(lang="en")
    head
        include partial/googleAnalysis.pug
        meta(charset="UTF-8")
        meta(http-equiv="X-UA-Compatible", content="IE=edge")
        meta(name="viewport", content="width=device-width, initial-scale=1.0, user-scalable=no")
        link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css")
        link(rel="stylesheet", href="/css/tableColor.css")
        link(rel="stylesheet", href="/css/bgCustom.css")
        link(rel="stylesheet", href="/css/borderCustom.css")
        if tableDate === "3days"
            title 최근 3일 통계
        else if tableDate === "all"
            title= tableVersion + " - 버전 전체 통계"        
        else if tableDate === "10days"
            title= tableVersion + " - 10일 통계"   
        else 
            title= tableDate + " - 일일 통계"
        script.
            function dataMouseOut(event) {
                event.currentTarget.className = "border-custom";
            }

            function dataMouseOver(event) {
                event.currentTarget.className = "table-success";
            }

            function dataMouseClick(event) {
                const url = window.location.href + '/character' +"?characterNum=" + event.currentTarget.id + "&bestWeapon=" + event.currentTarget.children[1].id;
                if(event.shiftKey) {
                    window.open(url).focus()
                }
                else if(event.ctrlKey) {
                    window.open(url, '_blank').focus()
                } 
                else {
                    window.location.href = url;
                }
            }

            function sortTable(event) {
                let table = document.getElementById("dataList");
                let rows = table.rows, idx = event.target.id, flag;
                let head = event.target.parentElement.children;

                for(let i=0; i<head.length; i++) { // delete latest others
                    if((head[i].innerHTML[head[i].innerHTML.length-1] === "▲" || head[i].innerHTML[head[i].innerHTML.length-1] === "▼") && head[i] != event.target) {
                        head[i].innerHTML = head[i].innerHTML.slice(0,-1);
                    } 
                }

                if(event.target.innerHTML[event.target.innerHTML.length-1] === "▲") {
                    flag = "DESC";
                    event.target.innerHTML = event.target.innerHTML.slice(0,-1);
                    event.target.innerHTML += "▼";
                }
                else if(event.target.innerHTML[event.target.innerHTML.length-1] === "▼") {
                    flag = "NONE";
                    event.target.innerHTML = event.target.innerHTML.slice(0,-1);
                    idx = 0;
                }
                else {
                    flag = "ASC";
                    event.target.innerHTML += "▲";
                }

                for(let i=0; i<rows.length-1; i++) {
                    for (let j = i+1; j < rows.length; j++) {
                        if(flag === "DESC") {
                            if (parseFloat(rows[i].cells[idx].innerHTML) > parseFloat(rows[j].cells[idx].innerHTML)) 
                                rows[i].parentNode.insertBefore(rows[j], rows[i]);
                        }
                        else if(flag === "ASC") {
                            if (parseFloat(rows[i].cells[idx].innerHTML) < parseFloat(rows[j].cells[idx].innerHTML)) 
                                rows[i].parentNode.insertBefore(rows[j], rows[i]);
                        }
                        else if(flag === "NONE") {
                            if (parseInt(rows[i].cells[idx].innerHTML) > parseInt(rows[j].cells[idx].innerHTML)) 
                                rows[i].parentNode.insertBefore(rows[j], rows[i]);
                        }
                    }   
                }
            } 
        include partial/title.pug
    body(class="bg-custom-1")
        include partial/nav.pug
        include partial/warning.pug
        div(class="container mt-5")
            div(class="container")
            div(class="table-responsive")
                if tableDate === "all"
                    pre(class="text-white")= "버전: "+tableVersion
                    pre(class="text-white")= "수집 일자: " + tableRange[0]['TABLE_NAME'].split('_')[1] +" ~ " + tableRange[tableRange.length-1]['TABLE_NAME'].split('_')[1]
                else if tableDate === "3days"
                    pre(class="text-white")= "수집 일자: " + tableRange[2]['TABLE_NAME'].split('_')[1] +" ~ " + tableRange[0]['TABLE_NAME'].split('_')[1]
                else if tableDate === "10days"
                    pre(class="text-white")= "버전: " + tableVersion
                    pre(class="text-white")= "수집 일자: " + tableRange[0]['TABLE_NAME'].split('_')[1] +" ~ " + tableRange[9]['TABLE_NAME'].split('_')[1]
                else
                    pre(class="text-white")= "일자: " + tableDate + " 버전: " + tableVersion
                table(class="table table-hovered table-borderless align-middle text-center")
                    thead(class="bg-custom-4 border-custom")
                        tr
                            th(id="0" scope="col") 번호
                            th(id="1" width="30%" scope="col") 캐릭터/무기
                            th(id="2" width="6%" scope="col" style="cursor:pointer" onclick="sortTable(event)") 픽률
                            th(id="3" width="6%" scope="col" style="cursor:pointer" onclick="sortTable(event)") 승률
                            th(id="4" width="7%" scope="col" style="cursor:pointer" onclick="sortTable(event)") TOP 3
                            th(id="5" width="7%" scope="col" style="cursor:pointer" onclick="sortTable(event)") TOP 5
                            th(id="6" width="8%" scope="col" style="cursor:pointer" onclick="sortTable(event)") 평균 순위
                            th(id="7" width="8%" scope="col" style="cursor:pointer" onclick="sortTable(event)") 평균 킬
                            th(id="8" width="12%" scope="col" style="cursor:pointer" onclick="sortTable(event)") 평균 MMR 변동
                            th(id="9" width="12%" scope="col" style="cursor:pointer" onclick="sortTable(event)") 평균 동물 처치
                    tbody(class="bg-custom-2" id="dataList")
                        -let mmr,cnt=1;
                        for item in characterData
                                tr(class="border-custom" id=item.characterNum onclick="dataMouseClick(event)" onmouseover="dataMouseOver(event)" onmouseout="dataMouseOut(event)" style="cursor:pointer")
                                    td(scope="row")= cnt
                                    td(id=item.bestWeapon style="text-align:left; text-indent:80px;")
                                        img(class="rounded-3 me-2" src=`/character/${item.characterNum}.png` width="9%" height="9%")
                                        img(class="rounded-3 me-2" src=`/weapon/${item.bestWeapon}.png` width="8%" height="8%")
                                        = character[item.characterNum-1]["name_ko"] + " / " + weapon[item.bestWeapon]
                                    td= Math.round((item.cnt / allCnt) * 10000) / 100+ "%"
                                    td= Math.round(item.top1 / item.cnt * 10000) / 100 + "%"
                                    td= Math.round((parseInt(item.top3) + parseInt(item.top1)) / item.cnt * 10000)/100 + "%"
                                    td= Math.round((parseInt(item.top5) + parseInt(item.top3) + parseInt(item.top1)) / item.cnt  * 10000)/100 + "%"
                                    td= Math.round(item.gameRank / item.cnt  * 10) / 10 + "등"
                                    td= Math.round(item.playerKill / item.cnt  * 100) / 100
                                    - mmr = Math.round(item.mmrGain / item.cnt  * 100) / 100
                                    if mmr > 0 
                                        td(class="text-success")= "+"+mmr
                                    else if mmr < 0
                                        td(class="text-danger")= mmr
                                    else
                                        td(class="text-muted")= mmr
                                    td= Math.round(item.monsterKill / item.cnt  * 10) / 10 + "마리"
                                -cnt++;
        include partial/contact.pug